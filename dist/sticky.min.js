(function(){'use strict';var k=angular.module('sticky',[]);k.directive('sticky',function(){return{restrict:'A',link:linkFn};function linkFn(f,g,h){var j,stickyClass,bodyClass,elem,$window,$body,doc,initialCSS,initialStyle,isPositionFixed,isSticking,stickyLine,stickyBottomLine,offset,anchor,confine,prevOffset,matchMedia,usePlaceholder,placeholder;isPositionFixed=false;isSticking=false;matchMedia=window.matchMedia;$window=angular.element(window);$body=angular.element(document.body);elem=g[0];doc=document.documentElement;j=h.mediaQuery||false;stickyClass=h.stickyClass||'';bodyClass=h.bodyClass||'';usePlaceholder=h.useplaceholder==undefined?false:true;initialStyle=g.attr('style');offset=typeof h.offset==='string'?parseInt(h.offset.replace(/px;?/,'')):0;anchor=typeof h.anchor==='string'?h.anchor.toLowerCase().trim():'top';confine=typeof h.confine==='string'?h.confine.toLowerCase().trim():'false';confine=(confine==='true');initialCSS={top:g.css('top'),width:g.css('width'),position:g.css('position'),marginTop:g.css('margin-top'),cssLeft:g.css('left')};switch(anchor){case'top':case'bottom':break;default:console.log('Unknown anchor '+anchor+', defaulting to top');anchor='top';break}$window.on('scroll',checkIfShouldStick);$window.on('resize',f.$apply.bind(f,onResize));f.$on('$destroy',onDestroy);function onResize(){initialCSS.offsetWidth=elem.offsetWidth;unstickElement();checkIfShouldStick();if(isSticking){var a=window.getComputedStyle(elem.parentElement,null),initialOffsetWidth=elem.parentElement.offsetWidth-a.getPropertyValue('padding-right').replace('px','')-a.getPropertyValue('padding-left').replace('px','');g.css('width',initialOffsetWidth+'px')}}function onDestroy(){$window.off('scroll',checkIfShouldStick);$window.off('resize',onResize);if(bodyClass){$body.removeClass(bodyClass)}if(placeholder){placeholder.remove()}}prevOffset=_getTopOffset(elem);f.$watch(function(){if(isSticking)return prevOffset;prevOffset=(anchor==='top')?_getTopOffset(elem):_getBottomOffset(elem);return prevOffset},function(a,b){if(a!==b||typeof stickyLine==='undefined'){stickyLine=a-offset;if(confine){g.parent().css({'position':'relative'})}var c=g.parent()[0];console.log(c.offsetHeight);var d=parseInt(c.offsetHeight);var e=parseInt(g.css('margin-bottom').replace(/px;?/,''))||0;stickyBottomLine=d-(elem.offsetTop+elem.offsetHeight)+offset+e;checkIfShouldStick()}});function checkIfShouldStick(){var a,shouldStick,scrollBottom,scrolledDistance;if(j&&!(matchMedia('('+j+')').matches||matchMedia(j).matches)){return}if(anchor==='top'){scrolledDistance=window.pageYOffset||doc.scrollTop;a=scrolledDistance-(doc.clientTop||0);if(confine===true){shouldStick=a>=stickyLine&&a<=stickyBottomLine}else{shouldStick=a>=stickyLine}}else{scrollBottom=window.pageYOffset+window.innerHeight;shouldStick=scrollBottom<=stickyLine}if(shouldStick&&!isSticking){stickElement()}else if(!shouldStick&&isSticking){var b,compare,closest;compare=[stickyLine,stickyBottomLine];closest=getClosest(compare,a);if(closest==stickyLine){b='top'}else if(closest==stickyBottomLine){b='bottom'}unstickElement(b,a)}}function getClosest(a,b){var i=0;var c=1000;var d;for(i in a){var m=Math.abs(b-a[i]);if(m<c){c=m;d=a[i]}}return d}function stickElement(){var a,absoluteLeft;a=g[0].getBoundingClientRect();absoluteLeft=a.left;initialCSS.offsetWidth=elem.offsetWidth;isSticking=true;if(bodyClass){$body.addClass(bodyClass)}if(stickyClass){g.addClass(stickyClass)}g.css('width',elem.offsetWidth+'px').css('position','fixed').css(anchor,offset+'px').css('left',absoluteLeft).css('margin-top',0);if(anchor==='bottom'){g.css('margin-bottom',0)}if(usePlaceholder){console.log('use placeholder!');placeholder=angular.element("<div>");var b=g[0].offsetHeight;placeholder.css("height",b+"px");g.after(placeholder)}}function unstickElement(a,b){g.attr('style',g.initialStyle);isSticking=false;if(bodyClass){$body.removeClass(bodyClass)}if(stickyClass){g.removeClass(stickyClass)}if(a=='top'){g.css('width','').css('top',initialCSS.top).css('position',initialCSS.position).css('left',initialCSS.cssLeft).css('margin-top',initialCSS.marginTop)}else if(a=='bottom'&&confine===true){g.css('width','').css('top','').css('bottom',0).css('position','absolute').css('left',initialCSS.cssLeft).css('margin-top',initialCSS.marginTop).css('margin-bottom',initialCSS.marginBottom)}if(placeholder){placeholder.remove()}}function _getTopOffset(a){var b=0;if(a.offsetParent){do{b+=a.offsetTop;a=a.offsetParent}while(a)}return b}function _getBottomOffset(a){return a.offsetTop+a.clientHeight}}});window.matchMedia=window.matchMedia||(function(){var a='angular-sticky: This browser does not support '+'matchMedia, therefore the minWidth option will not work on '+'this browser. Polyfill matchMedia to fix this issue.';if(window.console&&console.warn){console.warn(a)}return function(){return{matches:true}}}())}());
